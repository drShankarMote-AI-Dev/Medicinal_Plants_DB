<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4f46e5" />
  <title>Search - Medicinal Plants DB</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/plants.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}?v=8" />

  <script src="{{ url_for('static', filename='js/search.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/search-advanced.js') }}" defer></script>
  
  <!-- Filter options data (populated by backend) -->
  <script>
    window.filterData = {
      regions: {{ regions | tojson }},
      habitats: {{ habitats | tojson }},
      preparation_methods: {{ preparation_methods | tojson }},
      parts_used: {{ parts_used | tojson }},
      medicinal_uses: {{ medicinal_uses | tojson }}
    };
  </script>

<body>
  <div id="flashed-messages" style="display:none;">{{ flashed_messages_json | safe }}</div>

  <header>
    <nav class="navbar" role="navigation" aria-label="Main Navigation">
      <div class="nav-title">
        <i class="fas fa-leaf" aria-hidden="true"></i>
        <span>Medicinal Plants Database</span>
      </div>

      <div class="theme-controls">
        <label class="switch" title="Toggle dark and light mode">
          <input type="checkbox" id="theme-toggle" aria-label="Switch between dark and light mode">
          <span class="slider"><span class="icon">ðŸŒ™</span></span>
        </label>
      </div>

      <button class="mobile-menu-toggle" aria-expanded="false" aria-controls="nav-menu"
        aria-label="Toggle navigation menu">
        <i class="fas fa-bars" aria-hidden="true"></i>
      </button>

      <ul id="nav-menu" class="nav-links">
        <li><a href="{{ url_for('index') }}"><i class="fas fa-home" aria-hidden="true"></i> Home</a></li>
        <li><a href="{{ url_for('index') }}#about"><i class="fas fa-info-circle" aria-hidden="true"></i> About</a></li>
        <li><a href="{{ url_for('index') }}#contact"><i class="fas fa-envelope" aria-hidden="true"></i> Contact</a></li>
        <li><a href="{{ url_for('plants_page') }}"><i class="fas fa-seedling" aria-hidden="true"></i> Plants</a></li>
        <li><a href="{{ url_for('search_page') }}"><i class="fas fa-search" aria-hidden="true"></i> Search</a></li>
      </ul>
    </nav>
  </header>

  <main id="main-content">
    <!-- Hero Section -->
    <section class="hero-section" id="search-hero">
      <div class="hero-content">
        <!-- Hero Title and Subtitle Removed as per request -->
        <h1 class="hero-title" style="display: none;"></h1>
        <p class="hero-subtitle" style="display: none;"></p>

        <div class="hero-search">
          <form class="search-form" id="heroSearchForm">
            <div class="search-input-group">
              <input type="search" name="q" id="heroSearch" 
                placeholder="Search plants... (e.g., 'anxiety AND sleep NOT pregnancy')"
                value="{{ query if query else '' }}" aria-label="Search for plants" autocomplete="off">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-search"></i> Search
              </button>
            </div>
            <div id="searchSuggestions" class="search-suggestions"></div>
            <!-- Search Tips -->
            <div style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-secondary); text-align: center;">
              ðŸ’¡ Tip: Use AND/OR/NOT operators. Example: <code style="background: rgba(0,0,0,0.05); padding: 0.25rem 0.5rem; border-radius: 4px;">"anxiety" AND "safe pregnancy"</code>
            </div>
          </form>
        </div>

        <!-- Plant Comparison Panel -->
        <div id="comparisonPanel" style="display: none; margin: 1rem auto; padding: 1rem; background: var(--bg-alt); border-radius: 10px; border: 2px solid var(--primary); max-width: 900px; width: 100%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
            <h4 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-clone"></i> Comparing <span id="comparisonCount" style="font-weight: bold; color: var(--primary);">0</span> Plants
            </h4>
            <button id="clearComparisonBtn" class="btn btn-sm" style="background: var(--danger); color: white; padding: 0.4rem 0.8rem; border: none; border-radius: 15px; cursor: pointer;">
              <i class="fas fa-trash"></i> Clear
            </button>
          </div>
          <button id="viewComparisonBtn" class="btn btn-primary" style="width: 100%; padding: 0.75rem; border: none; border-radius: 8px; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
            <i class="fas fa-table"></i> View Side-by-Side Comparison
          </button>
        </div>

        <!-- Enhanced Filters Section -->
        <div style="margin-top: 1.5rem; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto;">
          <!-- Main Filters Row (Refactored for consistent container divs) -->
          <div class="filters-bar" style="display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: center;">
            <div class="filter-group filter-group-region">
              <!-- Region Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-globe"></i> Region <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="region-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;"></div>
              </details>
            </div>
            <div class="filter-group filter-group-habitat">
              <!-- Habitat Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-tree"></i> Habitat <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="habitat-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;"></div>
              </details>
            </div>
            <div class="filter-group filter-group-preparation">
              <!-- Preparation Method Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-mortar-pestle"></i> Preparation <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="preparation-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;"></div>
              </details>
            </div>
            <div class="filter-group filter-group-parts">
              <!-- Parts Used Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-leaf"></i> Parts Used <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="parts-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;"></div>
              </details>
            </div>
            <div class="filter-group filter-group-uses">
              <!-- Medicinal Uses Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-heart"></i> Uses <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="uses-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;"></div>
              </details>
            </div>
            <div class="filter-group filter-group-safety">
              <!-- Safety Filter -->
              <details class="filter-details" style="cursor: pointer;">
                <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                  <i class="fas fa-shield-alt"></i> Safety <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
                </summary>
                <div id="safety-filter-options" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;">
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="safePregnancyFilter" value="pregnancy" class="filter-checkbox">
                    <span><i class="fas fa-female" style="margin-right: 0.25rem;"></i> Safe in Pregnancy</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="noInteractionsFilter" value="no-interactions" class="filter-checkbox">
                    <span><i class="fas fa-pills" style="margin-right: 0.25rem;"></i> No Drug Interactions</span>
                  </label>
                </div>
              </details>
            </div>
            <div class="filter-group filter-group-image">
              <!-- Has Image Filter -->
              <label style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--secondary); cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: white; font-weight: 500;">
                <input type="checkbox" id="hasImageFilter" class="filter-checkbox">
                <i class="fas fa-image"></i> Has Image
              </label>
            </div>
            <div class="filter-group filter-group-sort">
              <!-- Sort Filter -->
              <div class="filter-dropdown">
                <select id="sortFilter" class="form-select" style="padding: 0.5rem 0.75rem; border-radius: 20px; border: none; font-weight: 500;">
                  <option value="relevance">Sort: Relevance</option>
                  <option value="name">Sort: Name (A-Z)</option>
                  <option value="name-desc">Sort: Name (Z-A)</option>
                  <option value="newest">Sort: Recently Added</option>
                  <option value="popular">Sort: Most Viewed</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Browse by Health Condition -->
          <div style="margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
            <!-- Health Condition Filter -->
            <details class="filter-details" style="cursor: pointer;">
              <summary style="padding: 0.5rem 1rem; border-radius: 20px; background: var(--primary); color: white; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; user-select: none;">
                <i class="fas fa-heartbeat"></i> Health Condition <i class="fas fa-chevron-down" style="font-size: 0.8em; transition: transform 0.3s;"></i>
              </summary>
              <div id="symptomFilter" class="filter-options" style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem; background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 10px;">
                <!-- Quick symptom buttons populated by JS -->
              </div>
            </details>
          </div>

          <!-- Active Filters Display -->
          <div class="search-active-filters" style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; min-height: 30px;">
          </div>

          <!-- Clear All Filters Button -->
          <div style="text-align: center; margin-top: 0.75rem;">
            <button id="clearFilters" class="btn btn-outline" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
              <i class="fas fa-times"></i> Clear All Filters
            </button>
          </div>
        </div>
      </div>

      <!-- Results Box on Right Side -->
      <div class="search-results-box">
        <div class="results-header">

          <p id="resultsInfo" class="results-count"><i class="fas fa-info-circle"></i> Start searching to see results
          </p>
        </div>
        <div id="resultsGrid" class="results-grid">
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <p>Type a plant name or medical use to begin exploring our comprehensive database</p>
          </div>
        </div>
        <div id="paginationContainer"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-branding"><i class="fas fa-leaf"></i><span>Medicinal Plants Database</span></div>
      <p class="copyright">&copy; 2025 All Rights Reserved</p>
      <div class="footer-disclaimer"><i class="fas fa-exclamation-triangle"></i><span>Information is for educational
          purposes only.</span></div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle logic
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const navMenu = document.getElementById('nav-menu');

    if (mobileMenuToggle && navMenu) {
      mobileMenuToggle.addEventListener('click', () => {
        const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
        mobileMenuToggle.setAttribute('aria-expanded', !isExpanded);
        navMenu.classList.toggle('active');
      });
    }

    // Theme toggle logic
    const themeToggle = document.getElementById('theme-toggle');
    const sliderIcon = document.querySelector('.slider .icon');

    const updateThemeIcon = (isDark) => {
      if (sliderIcon) {
        sliderIcon.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
      }
    };

    const applyTheme = (isDark) => {
      if (isDark) document.body.classList.add('dark');
      else document.body.classList.remove('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeIcon(isDark);
    };

    if (themeToggle) {
      const savedTheme = localStorage.getItem('theme') === 'dark';
      const prefersDark = !localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = savedTheme || prefersDark;

      themeToggle.checked = isDark;
      applyTheme(isDark);

      themeToggle.addEventListener('change', (e) => applyTheme(e.target.checked));
    }
  </script>

  <!-- Comparison Modal -->
  <div id="comparisonModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
    <div style="background: white; margin: 2rem auto; border-radius: 12px; max-width: 95vw; width: 100%; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
      <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 100;">
        <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.5rem;">
          <i class="fas fa-table"></i> Plant Comparison
        </h2>
        <button id="closeComparisonModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="comparisonTableContainer" style="padding: 1.5rem; overflow-x: auto;">
        <!-- Comparison table populated by JS -->
      </div>
    </div>
  </div>
</body>

</html>